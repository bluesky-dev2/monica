steps:
- bash: |
    echo "##vso[task.setvariable variable=DISPLAY]$DISPLAY"
    Xvfb ${DISPLAY} -screen 0 1920x1080x24 &
    php artisan dusk:chrome-driver $(google-chrome -version | awk '{ print $3 }' | cut -d . -f 1)
    ./vendor/laravel/dusk/bin/chromedriver-linux > /dev/null 2>&1 &
  displayName: Launch google chrome
  env:
    DISPLAY: ':99'

- bash: |
    php -S localhost:8000 -t public scripts/tests/server-cc.php &
    php -S localhost:8001 -t public scripts/tests/server-cc.php &
  displayName: Run http server

- script: php artisan dusk --log-junit results/junit/results0.xml
  displayName: Run browser tests
  env:
    CHROME_DRIVER_OPTS: --headless --disable-gpu --disable-dev-shm-usage --no-sandbox --remote-debugging-port=9222 --window-size=1920,1080
