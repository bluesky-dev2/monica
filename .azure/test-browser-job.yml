  - job: tests_browser
    dependsOn: build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - template: checkout-step.yml
    - template: prepare-environment-step.yml
    - template: composer-install-step.yml
    - template: prepare-db-step.yml
    - template: seed-test-db-step.yml
#    - bash: vendor/bin/chromedriver &
#      displayName: 'Run selenium chromedriver'
    - bash: scripts/tests/start-selenium.sh
      displayName: 'Run selenium chromedriver'
    - bash: php -S localhost:8000 -t public scripts/tests/server-cc.php &
      displayName: 'Run http server'
    - bash: until $(nc -z localhost 8000); do sleep 1; done
      displayName: 'Wait for http server'
    - bash: php artisan dusk --log-junit results/junit/dusk/results3.xml
      displayName: 'Run browser tests'
    - bash: |
        vendor/bin/phpcov merge --clover=results/coverage3.xml results/coverage/
        rm -rf results/coverage
      displayName: 'Fix coverage'
    - task: PublishPipelineArtifact@0
      inputs:
        artifactName: 'results'
        targetPath: 'results/junit'
